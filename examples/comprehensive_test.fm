// BBFM Comprehensive Test Suite
//
// This file tests all major language features in one place.
// All types automatically have universal metadata fields (not declared):
//   - Guid typeId (unique per type)
//   - Guid id (unique per instance)
//   - Int cardinality
//   - Timestamp creationDate
//   - Timestamp modificationDate
//   - String comment

// ============================================================================
// ENUMERATIONS
// ============================================================================

enum MediaType {
    AUDIO,
    VIDEO
}

enum Status {
    DRAFT,
    PUBLISHED,
    ARCHIVED
}

// ============================================================================
// PRIMITIVE TYPES - Test all primitive types
// ============================================================================

class PrimitiveTypes {
    feature stringField: String;
    feature intField: Int;
    feature realField: Real;
    feature boolField: Bool;
    feature timestampField: Timestamp;
    feature timespanField: Timespan;
    feature dateField: Date;
    feature guidField: Guid;
}

// ============================================================================
// FIELD MODIFIERS - Test all cardinality and constraint modifiers
// ============================================================================

class FieldModifiers {
    // Default modifier [1] - mandatory single value (no modifier specified)
    feature mandatoryField: String;

    // Explicit mandatory [1]
    feature explicitMandatory: String [1];

    // Optional using [optional] modifier (equivalent to [0..1])
    feature optionalField: String [optional];

    // Explicit optional [0..1]
    feature explicitOptional: String [0..1];

    // Arrays
    feature optionalArray: String [0..*];     // May be empty
    feature requiredArray: String [1..*];     // At least one element

    // Unique constraint
    feature uniqueField: String [unique];

    // Combined modifiers
    feature mandatoryUnique: String [1,unique];
    feature optionalUnique: String [optional,unique];
}

// ============================================================================
// FIELD NAMES MATCHING TYPE KEYWORDS - Test parser disambiguation
// ============================================================================

class FieldNamesMatchingTypes {
    // Field names that match primitive type names
    feature string: String;
    feature int: Int;
    feature real: Real;
    feature bool: Bool;
    feature timestamp: Timestamp;
    feature timespan: Timespan;
    feature date: Date;
    feature guid: Guid;
}

// ============================================================================
// INHERITANCE - Test single inheritance
// ============================================================================

class Asset {
    feature url: String;
    feature title: String;
    feature description: String [optional];
}

class AudioAsset inherits Asset {
    feature format: String;
    feature fileSize: Int;
    feature duration: Timespan;
    feature bitrate: Int [optional];
}

class VideoAsset inherits Asset {
    feature width: Int;
    feature height: Int;
    feature duration: Timespan;
    feature codec: String;
}

// ============================================================================
// INVARIANTS - Test all comparison operators and literal types
// ============================================================================

class InvariantTests {
    feature count: Int;
    feature price: Real;
    feature name: String;
    feature active: Bool;
    feature createdAt: Timestamp;
    feature duration: Timespan;

    // Integer literal comparisons
    invariant validCount: count >= 0;
    invariant maxCount: count <= 1000;
    invariant positiveCount: count > 0;
    invariant belowLimit: count < 999;
    invariant exactCount: count == 42;
    invariant notZero: count != 0;

    // Real literal comparisons
    invariant validPrice: price >= 0.0;
    invariant maxPrice: price <= 999.99;
    invariant positivePrice: price > 0.0;
    invariant belowThousand: price < 1000.0;

    // String literal comparisons
    invariant nonEmptyName: name != "";
    invariant specificName: name == "test";

    // Bool literal comparisons
    invariant isActive: active == true;
    invariant notInactive: active != false;

    // Timestamp comparisons (using Real literals since Timestamp maps to double)
    invariant validTimestamp: createdAt >= 0.0;
    invariant futureTimestamp: createdAt > 1704067200.0;

    // Timespan comparisons (using Real literals since Timespan maps to double)
    invariant validDuration: duration > 0.0;
    invariant maxDuration: duration <= 7200.0;
}

class ImageConstraints {
    feature width: Int;
    feature height: Int;
    feature format: String;

    invariant validWidth: width <= 3840;      // Max 4K width
    invariant validHeight: height <= 2160;    // Max 4K height
    invariant minWidth: width >= 100;
    invariant minHeight: height >= 100;
}

// ============================================================================
// RELATIONSHIPS - Test one-to-one, one-to-many, many-to-many
// ============================================================================

class Author {
    feature name: String;
    feature email: String [optional];
}

class Publisher {
    feature name: String;
    feature website: String [optional];
}

class Book {
    feature title: String;
    feature isbn: String [unique];
    feature publicationDate: Date;

    // One-to-one relationship
    feature primaryAuthor: Author;

    // Optional one-to-one
    feature publisher: Publisher [optional];

    // One-to-many (book has many authors)
    feature authors: Author [1..*];

    // Many-to-many (through arrays)
    feature tags: String [0..*];
}

// ============================================================================
// COMPLEX DOMAIN MODEL - Podcast example
// ============================================================================

class Podcast {
    feature title: String;
    feature description: String;
    feature author: String [optional];
    feature rssUrl: String [1,unique];
    feature coverArt: Asset [optional];
    feature episodes: Episode [0..*];
    feature status: Status;
}

class Episode {
    feature title: String;
    feature description: String [optional];
    feature publicationDate: Date;
    feature duration: Timespan;
    feature mediaType: MediaType;
    feature audioFile: AudioAsset;
    feature transcript: Transcript [optional];
    feature chapterMarkers: ChapterMarker [0..*];
}

class Transcript {
    feature text: String;
    feature language: String;
    feature format: String [optional];
}

class ChapterMarker {
    feature title: String;
    feature startTime: Timespan;
    feature endTime: Timespan [optional];

    invariant validStart: startTime >= 0.0;
}

// ============================================================================
// USER PREFERENCES - Boolean types
// ============================================================================

class UserPreferences {
    feature userId: Guid;
    feature emailNotifications: Bool;
    feature pushNotifications: Bool;
    feature darkMode: Bool [optional];
    feature isActive: Bool;
}

class FeatureFlags {
    feature enableBetaFeatures: Bool;
    feature allowGuestAccess: Bool;
    feature maintenanceMode: Bool;

    invariant safeMode: maintenanceMode == false;
}

// ============================================================================
// MULTI-LEVEL INHERITANCE
// ============================================================================

class MediaItem {
    feature title: String;
    feature description: String [optional];
}

class StreamableMedia inherits MediaItem {
    feature url: String;
    feature duration: Timespan;
}

class PodcastEpisode inherits StreamableMedia {
    feature episodeNumber: Int;
    feature seasonNumber: Int [optional];

    invariant validEpisode: episodeNumber > 0;
}

// ============================================================================
// INVARIANT INHERITANCE - Test that invariants are inherited with features
// ============================================================================

class BaseWithInvariant {
    feature width: Int;
    feature height: Int;

    invariant validWidth: width >= 100;
    invariant validHeight: height >= 100;
}

class DerivedWithInvariant inherits BaseWithInvariant {
    feature depth: Int;

    // This class inherits:
    // - features: width, height (from BaseWithInvariant)
    // - invariants: validWidth, validHeight (from BaseWithInvariant)
    // And adds its own:
    invariant validDepth: depth >= 10;
}

class FurtherDerivedWithInvariant inherits DerivedWithInvariant {
    feature color: String;

    // This class inherits:
    // - features: width, height, depth (from ancestor classes)
    // - invariants: validWidth, validHeight, validDepth (from ancestor classes)
    // And adds its own:
    invariant nonEmptyColor: color != "";
}
